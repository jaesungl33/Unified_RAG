{% extends "base.html" %}

{% block title %}GDD RAG - Unified RAG App{% endblock %}

{% block content %}
<div class="gdd-container" style="height: 100%;">
    <div id="tab-rag" class="tab-content active h-full" style="height: 100%;">
        <div class="layout">
            <!-- Sidebar -->
            <div class="sidebar" id="gdd-sidebar">
                <div class="sidebar-content">
                    <!-- Manage Documents Navigation -->
                    <div style="padding: 16px 12px; border-bottom: 1px solid var(--border);">
                        <a href="/manage" class="btn-secondary w-full" style="display: flex; height: 36px; font-size: 0.8125rem; gap: 8px; justify-content: center; align-items: center; text-decoration: none;">
                            <img src="{{ url_for('static', filename='icons/upload.svg') }}" width="14" height="14" style="opacity: 0.7;">
                            Manage Documents
                        </a>
                    </div>

                    <!-- Search -->
                    <div class="sidebar-search-container">
                        <input type="text" id="document-search" class="document-search" placeholder="Search documents...">
                    </div>
                    
                    <h2>
                        <img src="{{ url_for('static', filename='icons/file.svg') }}" width="12" height="12" opacity="0.5">
                        Indexed Documents
                    </h2>

                    <div class="document-list-container">
                        <div id="documents-list">
                            <div class="placeholder-text" style="font-size: 0.75rem; padding: 20px;">Loading documents...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Chat Panel -->
            <div class="main-panel">
                <div class="chat-header">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <button id="toggle-sidebar" class="action-btn" title="Toggle Sidebar" style="opacity: 1;">
                            <img src="{{ url_for('static', filename='icons/sidebar-toggle.svg') }}" width="18" height="18">
                        </button>
                        <h3 style="font-size: 0.875rem; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            <img src="{{ url_for('static', filename='icons/chat.svg') }}" width="16" height="16">
                            GDD RAG
                        </h3>
                    </div>
                    <button id="clear-chat-btn" class="btn-secondary" style="height: 32px; padding: 0 12px; font-size: 0.75rem; display: flex; align-items: center; gap: 8px; border: none; background: transparent; color: var(--muted-foreground);">
                        <img src="{{ url_for('static', filename='icons/trash.svg') }}" width="14" height="14" style="opacity: 0.6;">
                        Clear chat
                    </button>
                </div>

                <div class="chat-container" id="chat-container">
                    <div id="gdd-welcome-message" style="display: flex; flex-direction: column; align-items: center; text-align: center; padding: 60px 0;">
                        <div style="width: 48px; height: 48px; background: var(--muted); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                            <img src="{{ url_for('static', filename='icons/chat.svg') }}" width="24" height="24" opacity="0.5">
                        </div>
                        <h3 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 8px;">GDD RAG Chatbot</h3>
                        <p style="color: var(--muted-foreground); font-size: 0.875rem; max-width: 320px;">
                            Ask questions about your documents. Use <span style="color: var(--primary); font-family: var(--font-mono);">@document</span> for specific files.
                        </p>
                    </div>
                </div>
                
                <!-- Chat Input -->
                <div class="input-area" style="padding: 16px 24px 24px;">
                    <div style="width: 100%; max-width: 768px; margin: 0 auto; position: relative;">
                        <textarea id="query-input" placeholder="Ask a question... (use @document @section)" 
                                  style="width: 100%; min-height: 48px; max-height: 200px; padding: 12px 100px 12px 16px; border: 1px solid var(--border); border-radius: var(--radius-lg); font-family: var(--font-body); font-size: 0.9375rem; resize: none;"></textarea>
                        <button id="send-btn" class="btn-primary" style="position: absolute; right: 8px; bottom: 8px; height: 32px; padding: 0 16px; font-size: 0.8125rem;">
                            <span>Send</span>
                            <img src="{{ url_for('static', filename='icons/send.svg') }}" width="14" height="14" style="filter: brightness(0) invert(1);">
                        </button>
                        <div id="selected-doc-hint" style="font-size: 0.7rem; color: var(--primary); margin-top: 6px; font-weight: 500;"></div>
                    </div>
                </div>
            </div>

            <!-- Right Preview Panel -->
            <div class="preview-panel" id="preview-panel">
                <div class="chat-header" style="padding: 0 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; min-width: 0;">
                        <img id="preview-icon" src="{{ url_for('static', filename='icons/file.svg') }}" width="16" height="16">
                        <span id="preview-filename" style="font-size: 0.8125rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Document Preview</span>
                    </div>
                    <button id="close-preview" class="action-btn" title="Close Preview" style="opacity: 1;">
                        <img src="{{ url_for('static', filename='icons/close.svg') }}" width="16" height="16">
                    </button>
                </div>
                
                <div style="flex: 1; overflow-y: auto; padding: 20px;">
                    <div id="preview-metadata" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                        <div>
                            <div style="font-size: 0.65rem; text-transform: uppercase; color: var(--muted-foreground); margin-bottom: 4px;">File Size</div>
                            <div id="meta-size" style="font-size: 0.8125rem; font-weight: 600;">-</div>
                        </div>
                        <div>
                            <div style="font-size: 0.65rem; text-transform: uppercase; color: var(--muted-foreground); margin-bottom: 4px;">Chunks</div>
                            <div id="meta-chunks" style="font-size: 0.8125rem; font-weight: 600;">-</div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; margin-bottom: 32px;">
                        <button class="btn-secondary" style="flex: 1; height: 36px; font-size: 0.75rem;">
                            <img src="{{ url_for('static', filename='icons/download.svg') }}" width="14" height="14" style="margin-right: 6px;">
                            Download
                        </button>
                        <button class="btn-secondary" style="flex: 1; height: 36px; font-size: 0.75rem;">
                            <img src="{{ url_for('static', filename='icons/external-link.svg') }}" width="14" height="14" style="margin-right: 6px;">
                            Open Original
                        </button>
                    </div>

                    <div style="font-size: 0.65rem; text-transform: uppercase; color: var(--muted-foreground); margin-bottom: 12px; letter-spacing: 0.05em;">Content Preview</div>
                    <div id="preview-content" style="background: var(--muted); border-radius: var(--radius-md); padding: 16px; font-family: var(--font-mono); font-size: 0.75rem; color: var(--foreground); line-height: 1.6; min-height: 200px;">
                        Select a document to preview its content.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/gdd.js') }}"></script>
{% endblock %}