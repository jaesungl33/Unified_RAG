{% extends "base.html" %}

{% block title %}GDD RAG - Unified RAG App{% endblock %}

{% block content %}
<div class="gdd-container" style="height: 100%;">
    <div id="tab-rag" class="tab-content active h-full" style="height: 100%;">
        <div class="layout">
            <!-- Sidebar -->
            <div class="sidebar" id="gdd-sidebar">
                <h2>
                    <img src="{{ url_for('static', filename='icons/file.svg') }}" width="14" height="14">
                    GDD Documents
                </h2>
                <!-- Manage Documents Navigation -->
                <div style="padding: 0 0 16px; border-bottom: 1px solid var(--border); margin-bottom: 16px;">
                    <a href="/manage" class="btn-secondary w-full"
                        style="display: flex; height: 36px; font-size: 0.8125rem; gap: 8px; justify-content: center; align-items: center; text-decoration: none;">
                        <img src="{{ url_for('static', filename='icons/upload.svg') }}" width="14" height="14"
                            style="opacity: 0.7;">
                        Manage Documents
                    </a>
                </div>

                <div style="position: relative; padding: 0 12px 12px;">
                    <h3
                        style="font-size: 0.8125rem; font-weight: 600; display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <img src="{{ url_for('static', filename='icons/file.svg') }}" width="16" height="16">
                        Documents <span id="doc-count"
                            style="color: var(--muted-foreground); font-weight: 400; font-size: 0.75rem;"></span>
                    </h3>
                    <input type="text" id="document-search" class="document-search" placeholder="Search documents...">
                </div>

                <div class="document-list-container" style="padding-top: 8px;">
                    <div id="documents-list">
                        <div class="placeholder-text" style="font-size: 0.75rem; padding: 20px;">Loading documents...
                        </div>
                    </div>
                </div>

                <div class="border-t border-border mt-4 pt-4">
                    <p style="font-size: 0.75rem; color: var(--text-muted); line-height: 1.4;">
                        <strong>Tip:</strong> Use <code
                            style="background: #E2E8F0; padding: 1px 3px; border-radius: 2px;">@document</code> to
                        filter queries.
                    </p>
                </div>
            </div>

            <!-- Main Chat Panel -->
            <div class="main-panel">
                <div class="chat-container" id="chat-container">
                    <div class="message bot-message" id="gdd-welcome-message">
                        <div
                            style="display: flex; flex-direction: column; align-items: center; text-align: center; padding: 40px 0;">
                            <div class="icon-box"
                                style="width: 48px; height: 48px; background: #EEF2FF; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                                <img src="{{ url_for('static', filename='icons/file.svg') }}" width="24" height="24"
                                    style="filter: invert(26%) sepia(89%) saturate(1583%) hue-rotate(217deg) brightness(96%) contrast(93%);">
                            </div>
                            <h3 style="margin-bottom: 8px;">GDD RAG Assistant</h3>
                            <p style="color: var(--text-muted); max-width: 400px;">Ask questions about your documents.
                                Use <span style="color: var(--primary); font-family: var(--font-mono);">@document</span>
                                to target specific files.</p>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="input-area">
                    <button type="button" id="clear-chat-btn" class="btn-secondary" title="Clear Chat">
                        <img src="{{ url_for('static', filename='icons/trash.svg') }}" width="18" height="18">
                    </button>
                    <input type="text" id="query-input" placeholder="Ask a question... (use @document @section)">
                    <button id="send-btn" class="btn-primary">
                        <span>Send</span>
                        <img src="{{ url_for('static', filename='icons/send.svg') }}" width="18" height="18"
                            style="filter: brightness(0) invert(1);">
                    </button>
                </div>
                <div id="selected-doc-hint"
                    style="font-size: 0.7rem; color: var(--primary); padding: 0 24px 12px; font-weight: 500; text-align: center;">
                </div>
            </div>

            <!-- Right Preview Panel -->
            <div class="preview-panel" id="preview-panel">
                <div class="chat-header" style="padding: 0 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; min-width: 0;">
                        <img id="preview-icon" src="{{ url_for('static', filename='icons/file.svg') }}" width="16"
                            height="16">
                        <span id="preview-filename"
                            style="font-size: 0.8125rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Document
                            Preview</span>
                    </div>
                    <button id="close-preview" class="action-btn" title="Close Preview" style="opacity: 1;">
                        <img src="{{ url_for('static', filename='icons/close.svg') }}" width="16" height="16">
                    </button>
                </div>

                <div style="flex: 1; overflow-y: auto; padding: 20px;">
                    <div id="preview-metadata"
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                        <div>
                            <div
                                style="font-size: 0.65rem; text-transform: uppercase; color: var(--muted-foreground); margin-bottom: 4px;">
                                File Size</div>
                            <div id="meta-size" style="font-size: 0.8125rem; font-weight: 600;">-</div>
                        </div>
                        <div>
                            <div
                                style="font-size: 0.65rem; text-transform: uppercase; color: var(--muted-foreground); margin-bottom: 4px;">
                                Chunks</div>
                            <div id="meta-chunks" style="font-size: 0.8125rem; font-weight: 600;">-</div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 12px; margin-bottom: 32px;">
                        <button class="btn-secondary" id="gdd-download-btn"
                            style="flex: 1; height: 36px; font-size: 0.75rem;">
                            <img src="{{ url_for('static', filename='icons/download.svg') }}" width="14" height="14"
                                style="margin-right: 6px;">
                            Download
                        </button>
                        <button class="btn-secondary" id="gdd-open-original-btn"
                            style="flex: 1; height: 36px; font-size: 0.75rem;">
                            <img src="{{ url_for('static', filename='icons/external-link.svg') }}" width="14"
                                height="14" style="margin-right: 6px;">
                            Open Original
                        </button>
                    </div>

                    <div
                        style="font-size: 0.65rem; text-transform: uppercase; color: var(--muted-foreground); margin-bottom: 12px; letter-spacing: 0.05em;">
                        Content Preview</div>
                    <div id="preview-content"
                        style="background: var(--muted); border-radius: var(--radius-md); padding: 16px; font-family: var(--font-mono); font-size: 0.75rem; color: var(--foreground); line-height: 1.6; min-height: 200px;">
                        Select a document to preview its content.
                    </div>
                </div>
            </div>

            <!-- Document Viewer Sidebar (same as Keyword Finder View Doc, resizable) -->
            <div id="gdd-document-viewer-sidebar" class="preview-panel"
                style="width: 0; min-width: 0; background: white; border-left: 1px solid var(--border); box-shadow: var(--shadow-lg); display: flex; flex-direction: row; z-index: 50; position: relative; height: 100%; transition: width 0.3s ease-in-out; overflow: hidden; transform: none;">
                <div id="gdd-document-viewer-resize-handle" title="Drag to resize"
                    style="width: 6px; flex-shrink: 0; cursor: col-resize; background: transparent;"></div>
                <div style="flex: 1; min-width: 0; display: flex; flex-direction: column; overflow: hidden;">
                    <div class="preview-panel-header">
                        <div class="preview-panel-title">
                            <img src="{{ url_for('static', filename='icons/file.svg') }}" width="18" height="18"
                                style="opacity: 0.7;">
                            <div class="preview-panel-title-text">
                                <span id="gdd-document-viewer-doc-name" class="preview-doc-name">Document Preview</span>
                            </div>
                        </div>
                        <button id="gdd-close-document-viewer-btn" class="action-btn" title="Close document viewer">
                            <img src="{{ url_for('static', filename='icons/close.svg') }}" width="16" height="16"
                                style="opacity: 0.5;">
                        </button>
                    </div>
                    <div id="gdd-document-viewer-content" class="preview-panel-content flex-1"
                        style="display: flex; flex-direction: column; padding: 0; overflow: hidden; min-height: 0; height: 100%;">
                        <p class="placeholder-text"
                            style="text-align: center; color: var(--muted-foreground); font-size: 0.875rem; margin: auto;">
                            Document preview will appear here.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/gdd.js') }}"></script>
{% endblock %}